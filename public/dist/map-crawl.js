"use strict";$(document).ready(function(){function e(e){return{geometry:{x:e.loc[0],y:e.loc[1]},attributes:{Name:e.name}}}function t(t){return{features:t.map(e)}}function n(e){return{geometry:{x:e.loc[0],y:e.loc[1]},attributes:{Name:e.name}}}function a(e){return{features:e.map(n)}}function o(e,t){return{attributes:{Name:"Route "+(t+1),StartDepotName:e.name,EarliestStartTime:14556096e5,LatestStartTime:14556096e5}}}function r(e){return{features:e.map(o)}}function i(e){var t=e.value.features;t.forEach(function(e){var n=t[0].geometry.paths[0].map(function(e){return L.latLng(e[1],e[0])}),a=L.polyline(n);g.addLayer(a)}),$(".loader").hide()}function c(e){return function(t){var n=t.value.features.slice().sort(function(e,t){return e.attributes.Sequence-t.attributes.Sequence}).map(function(e){return e.attributes.Name}).map(function(t){return e.find(function(e){return e.name===t})}).filter(Boolean);d(n)}}function s(e){console.log("showDirections",e)}function u(e,n,o,u){var l="https://logistics.arcgis.com/arcgis/rest/services/World/VehicleRoutingProblem/GPServer/SolveVehicleRoutingProblem",d=u,p=o.slice(0,1),f=o.slice(1),m=new e(l+"?token="+d),g={default_date:14556096e5,time_units:"Minutes",distance_units:"Miles",depots:JSON.stringify(t(p)),orders:JSON.stringify(a(f)),routes:JSON.stringify(r(p)),populate_directions:!0};m.submitJob(g).then(function(e){m.getResultData(e.jobId,"out_routes").then(i),m.getResultData(e.jobId,"out_stops").then(c(o)),m.getResultData(e.jobId,"out_directions").then(s)})}function l(e,t){var n=$("input").val();$.ajax({url:"/api/crawls/breweries/"+n,success:function(n){n=n,k(n),$.ajax({url:"/api/token",success:function(a){console.log(n.breweries),u(e,t,n.breweries,a)}})}})}function d(e){e.forEach(function(e){$(".allBreweries .brews").append("\n        <div class='brew' data-long=\""+e.loc[0]+'" data-lat="'+e.loc[1]+'">\n          <img src="'+e.logo+'" />\n          <h3>'+e.name+"</h3>\n        </div>\n        ")})}function p(){var e=$(".allBreweries");e.removeClass("active"),e.css("right","-260px")}var f=null,m=null,g=L.map("map").setView([39.13,-84.5167],12);L.tileLayer("https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}",{attribution:'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="http://mapbox.com">Mapbox</a>',maxZoom:18,id:"jakeboyles.j0ajipap",accessToken:"pk.eyJ1IjoiamFrZWJveWxlcyIsImEiOiJNcGJpWXhJIn0.ONDjoScLnbU4_VVfXmeIAA"}).addTo(g);var h=new L.FeatureGroup,b={keepSpiderfied:!0},v=new OverlappingMarkerSpiderfier(g,b),y=new L.Popup;v.addListener("click",function(e){y.setContent(e.desc),y.setLatLng(e.getLatLng()),g.openPopup(y)});var h=new L.FeatureGroup,k=function(e){e=e.breweries,e.forEach(function(e){var t=new L.LatLng(e.loc[1],e.loc[0]),n=L.icon({iconUrl:e.logo,iconSize:[45,55],shadowSize:[50,64],iconAnchor:[22,54],shadowAnchor:[4,62],popupAnchor:[-3,-86]}),a=new L.Marker(t,{icon:n});a.desc="\n    <b>"+e.name+"</b>\n    <p class='content'>\n    <i class=\"fa fa-home\"></i> "+e.address+'<br>\n    <i class="fa fa-phone"></i> '+e.phone+'<br>\n    <img\n      width="40"\n      height="40"\n      class="uber-link"\n      src="/images/uber.png"\n      data-latitude="'+e.loc[1]+'"\n      data-longitude="'+e.loc[0]+'"\n      data-name="'+e.name+'"\n      data-address="'+e.address+", "+e.city+", "+e.state+" "+e.zip+'"\n    />\n    </p>',h.addLayer(a),v.addMarker(a)}),g.addLayer(h)};if($("body").on("click",".uber-link",function(){var e=$(this),t=e.data("latitude"),n=e.data("longitude"),a=e.data("name"),o=e.data("address"),r="https://m.uber.com/ul?client_id=gY6iGb3XfnCI35tZ968HvPWA1rmgBSK1&action=setPickup&pickup[latitude]="+f+"&pickup[longitude]="+m+"&pickup[nickname]=Current%20Location&dropoff[latitude]="+t+"&dropoff[longitude]="+n+"&dropoff[nickname]="+encodeURIComponent(a)+"&dropoff[formatted_address]="+encodeURIComponent(o)+"&product_id=68cddf62-ea57-4cdf-9c63-dfbfebfd7095";window.location=r}),$("body").on("click",".brew",function(){var e=$(this),t=e.data("long"),n=e.data("lat"),a=L.latLng(n,t);g.setView(a,14),p()}),$(".flyout").on("click",function(){var e=$(this).parent();e.toggleClass("active"),e.hasClass("active")?e.css("right","0px"):e.css("right","-260px")}),"geolocation"in navigator){var w=null;navigator.geolocation.watchPosition(function(e){w&&(h.removeLayer(w),v.removeMarker(w));var t=e.coords;f=t.latitude,m=t.longitude;var n=L.latLng(f,m);w=new L.Marker(n),h.addLayer(w),v.addMarker(w)})}var S=["esri/tasks/Geoprocessor","esri/geometry/Point"];require(S,l)});